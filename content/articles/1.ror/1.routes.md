---
title: 'Ruby on Rails - Routage'
description: 'Les routes avec RoR'
icon: 'i-mdi:language-ruby'
color: 'red'
article_id: '1-ror-routes'
---

#### üìå Qu'est-ce que le Routage dans Rails ?

Le routage dans Rails, c'est ce qui relie vos URLs aux actions de vos contr√¥leurs. 

Par exemple, une requ√™te GET vers /articles pourrait √™tre dirig√©e vers l'action index dans le contr√¥leur Articles (*ArticlesController#index*). 

C‚Äôest dans le fichier **config/routes.rb** que tout cela est configur√©. 

Chaque route correspond √† un petit ensemble : un verbe HTTP (comme GET, POST, PATCH ou DELETE), un mod√®le d‚ÄôURL, une action sp√©cifique dans le contr√¥leur, et parfois des contraintes ou des helpers pour simplifier l‚Äôutilisation des routes.


#### üó∫Ô∏è D√©finitions de Base des Itin√©raires

Voici une petite explication pour mieux comprendre comment d√©finir des routes dans votre application Rails :

1. Syntaxe Standard

Pour faire simple, si vous voulez que lorsqu‚Äôon acc√®de √† l‚ÄôURL `/welcome/index`, cela lance la m√©thode `index` dans le contr√¥leur `Welcome`, vous pouvez √©crire :  

```ruby [config/routes.rb]
get 'welcome/index'
```
  
Cela dit √† Rails : ‚ÄúLorsque quelqu‚Äôun va sur */welcome/index*, montre le contenu de la m√©thode *index* du contr√¥leur *Welcome*.‚Äù


2. Route Racine

Pour que la page d‚Äôaccueil de votre site soit par exemple la page `home#index`, il suffit d‚Äô√©crire :  

```ruby [config/routes.rb]
root 'home#index'
```

Et voil√†, votre site affiche cette page d√®s qu‚Äôon arrive √† la racine !

3. Routes Nom√©es

C‚Äôest pratique si vous souhaitez donner un nom plus sympa √† une route. Par exemple, si vous voulez que l‚ÄôURL */about* m√®ne √† la page d√©di√©e, et que vous pouvez utiliser un helper pratique comme *about_page_path*, √©crivez :  

```ruby [config/routes.rb]
get 'about', to: 'pages#about', as: 'about_page'
```

Du coup, dans votre code, vous pouvez √©crire *about_page_path* pour g√©n√©rer cette URL facilement.

4. Routes RESTful avec `resources` :

Rails favorise une fa√ßon naturelle de g√©rer les ressources via REST. En tapant simplement :  

```ruby [config/routes.rb]
resources :articles
```

Rails va automatiquement cr√©er tout un ensemble d‚Äôitin√©raires pour faire :  
- voir la liste des articles (`index`)  
- voir un article pr√©cis (`show`)  
- cr√©er un nouvel article (`new`, `create`)  
- modifier un article (`edit`, `update`)  
- supprimer un article (`destroy`)  


Si vous souhaitez limiter cet ensemble √† seulement quelques actions, vous pouvez pr√©ciser :  

```ruby [config/routes.rb]
resources :articles, only: [:index, :show]
```


Ou si vous voulez exclure quelques actions, par exemple la suppression, vous pouvez √©crire :  

```ruby [config/routes.rb]
resources :articles, except: [:destroy]
```

##### üó∫Ô∏è Itin√©raires de Ressources Nomm√©es

Utiles lorsque vous avez des mod√®les avec des relations hi√©rarchiques (par exemple, articles et commentaires) :

```ruby [config/routes.rb]
resources :articles do
  resources :comments
end
```

Cela g√©n√®re des itin√©raires comme :

```ruby [bash]
/articles/:article_id/comments
/articles/:article_id/comments/:id
```

Pour √©viter un enchev√™trement profond, limitez-vous √† une seule couche pour plus de clart√© et de maintenabilit√©.


##### üó∫Ô∏è Itin√©raires Membres vs Collection

Vous avez la possibilit√© de d√©finir des actions personnalis√©es aussi bien sur des √©l√©ments individuels (membres) que sur l'ensemble de la collection.

Voici un exemple pour mieux comprendre :

```ruby [config/routes.rb]
resources :articles do
  member do
    get 'preview'
  end

  collection do
    get 'archived'
  end
end
```


L‚Äôitin√©raire pour un membre sp√©cifique sera par exemple : */articles/:id/preview*, tandis que celui pour toute la collection sera : */articles/archived*.


##### üè∑Ô∏è Espaces de Noms et Routage

Les espaces de noms, c'est super pratique pour organiser tout √ßa, surtout quand il s'agit des panneaux d'administration ou des API. 

√áa permet de garder les contr√¥leurs bien rang√©s et de structurer les routes en toute simplicit√©.

Par exemple, pour l'espace admin, vous pouvez faire comme ceci :

```ruby [config/routes.rb]
namespace :admin do
  resources :users
end
```

√áa correspond √† un contr√¥leur appel√© `Admin::UsersController` et √ßa cr√©e des itin√©raires comme `/admin/users`, pratique non ?

Et pour les APIs, c'est pareil : vous pouvez imbriquer les namespaces afin de bien structurer tout votre API, comme ici :


```ruby [config/routes.rb]
namespace :api do
  namespace :v1 do
    resources :products
  end
end
```


Ainsi, vos routes seront toutes bien organis√©es, par exemple `/api/v1/products`. C'est simple, efficace et √ßa facilite la maintenance !


##### üîÄ Routage Superficiel

Le routage en profondeur peut parfois devenir un peu compliqu√©. Pour simplifier la gestion des URLs, optez pour le routage superficiel ! voici comment faire¬†!  

```ruby [config/routes.rb]
resources :articles do
  resources :comments, shallow: true
end
```

Gr√¢ce √† cette configuration, les chemins g√©n√©r√©s seront plus simples :

```ruby [bash]
/articles/:article_id/comments # pour index, create
/comments/:id # pour show, edit, update, destroy
```


##### ‚ö†Ô∏è Contraintes et Conditions de Route Personnalis√©es

Vous pouvez limiter les itin√©raires selon certains param√®tres ou conditions, comme par exemple :

en utilisant *constraints* :

```ruby [config/routes.rb]
get 'photos/:id', to: 'photos#show', constraints: { id: /\d+/ }
```


ou avec le routage bas√© sur le sous-domaine :

```ruby [config/routes.rb]
constraints subdomain: 'admin' do
  get '/', to: 'admin/dashboard#index'
end
```

##### üìè Pr√©occupations pour un Routage DRY

N'h√©sitez pas √† utiliser *concerns* pour r√©utiliser facilement les d√©finitions d'itin√©raires, comme ici :  

```ruby [config/routes.rb]
concern :commentable do
  resources :comments
end

resources :articles, concerns: :commentable   
resources :photos, concerns: :commentable
```

##### üìÇ Organisation des routes

Pour rendre notre code plus clair et organis√©, on va cr√©er un petit initializer qui va nous permettre d‚Äôinterpr√©ter facilement nos fichiers de routes modulares, situ√©s dans *config/routes/*.  

Voici comment faire :  

```ruby [config/initializers/routes_draw.rb]
class ActionDispatch::Routing::Mapper
  def draw(routes_name)
    path = Rails.root.join("config/routes/#{routes_name}.rb")
    
    raise ArgumentError, "Fichier manquant: #{path}" unless File.exist?(path)
    
    instance_eval(path.read, path.to_s)
  end
end
```

Ce syst√®me permet de mieux s√©parer les responsabilit√©s :  
- *routes.rb* sert √† d√©clarer nos routes globales,  
- le fichier dans *initializers/* se charge d‚Äô√©tendre la classe Mapper pour charger nos routes modulaires.  

Par exemple, dans *config/routes.rb*, on peut faire appel √† notre m√©thode `draw` comme ceci :  


```ruby [config/routes.rb]
Rails.application.routes.draw do
  ...
  
  draw :users

  ...
end
```

Et pour illustrer la structure d‚Äôun fichier de routes modulaire, voici un exemple dans *config/routes/users.rb* :  

```ruby [config/routes/users.rb]
# /users
namespace :users do
  # /profiles
  get   '/profiles',               to: 'profiles#index'
  get   '/profiles/list',          to: 'profiles#list'
  get   '/profiles/:profile_id',   to: 'profiles#show'
  post  '/profiles',               to: 'profiles#save'
  get   '/profiles/show-avatar',   to: 'profiles#show_avatar'
  post  '/profiles/upload-avatar', to: 'profiles#upload_avatar'

  # /groups
  resources :groups
  post '/groups/:group_id/add-member',     to: 'groups#add_member'
  post '/groups/:group_id/remove-member',  to: 'groups#remove_member'
end
```


##### ‚Ü™Ô∏è Redirections et Param√®tres par D√©faut

Voici comment rediriger un itin√©raire vers un autre :  

```ruby [config/routes.rb]
get '/home', to: redirect('/')
```

Et si vous souhaitez d√©finir des param√®tres par d√©faut, c‚Äôest par ici :  

```ruby [config/routes.rb]
get 'posts/:id', to: 'posts#show', defaults: { format: :json }
```

##### üõë Erreurs de Routage et D√©bogage

Utilisez rails routes ou bin/rails routes pour voir tous les itin√©raires d√©finis.

Flags utiles :

```ruby [bash]
rails routes | grep articles
```

##### üìã R√©sum√©

Le routage dans la version actuelle de Ruby on Rails est super flexible, puissant et vraiment clair √† utiliser.  

En ma√Ætrisant le routage, vous pouvez cr√©er des applications web plus expressives, faciles √† maintenir et qui √©voluent sans souci.  

Que ce soit pour d√©finir des itin√©raires simples pour vos ressources ou pour construire une API complexe, Rails offre tous les outils dont vous avez besoin pour le faire de mani√®re propre et efficace.

